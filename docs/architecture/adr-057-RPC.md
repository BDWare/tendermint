# ADR 057: RPC

## Changelog

- 19-05-2020: created

## Context

Currently the RPC layer of Tendermint is using a variant of the JSON-RPC protocol. This ADR is meant to serve as a pro/con list for possible alternatives and JSON-RPC.

There are currently two options being discussed: gRPC & JSON-RPC.

### JSON-RPC:

JSON-RPC is a JSON-based RPC protocol. Tendermint has implemented its own variant of JSON-RPC which is not compatible with the [JSON-RPC 2.0 specification](https://www.jsonrpc.org/specification).

**Pros:**

- Simple
- Well-known and well-understood by users and integrators
- Easy to interface with (HTTP and JSON)
- Mature, common, and familiar tooling (e.g. `curl` and `jq`)
- Integrates reasonably well with web infrastructure (proxies, API gateways, service meshes, caches, etc)

**Cons:**

- No schema support
- RPC clients must be hand-written
- Streaming not built into protocol
- Underspecified types (e.g. numbers and timestamps)
- Tendermint has its own implementation (not standards compliant, maintenance overhead)
- Stdlib `jsonrpc` package only supports JSON-RPC 1.0, no dominant package for JSON-RPC 2.0
- Tooling around documentation/specification (e.g. Swagger) could be better
- JSON data is larger (offset by HTTP compression)
- Serializing is slower ([~100% marshal, ~400% unmarshal](https://github.com/alecthomas/go_serialization_benchmarks)); insignificant in absolute terms

### gRPC:

gRPC is a high performant RPC framework. It has been battle tested by a large number of users and is heavily relied on and maintained by countless large corporations.

**Pros:**

- Efficient data retrieval for users, lite clients and other protocols
- Easily implemented in supported languages (Go, Dart, JS, TS, rust, Elixir, Haskell, ...)
- Can provide a REST API via [gRPC-gateway](https://github.com/grpc-ecosystem/grpc-gateway)
- Can provide a GraphQL API via [Rejoiner](https://github.com/google/rejoiner)
- Defined schema with richer type system (Protocol Buffers)
- Established conventions for forwards- and backwards-compatibility
- Bi-directional streaming
- Servers and clients can be autogenerated in many languages (e.g. Tendermint-rs)

**Cons:**

- Users/integrators may not be familiar with gRPC and Protobuf; learning curve
- Complex system involving cross-language schemas, code generation, and custom protocols
- Tooling is less mature and harder to use (see e.g. `grpcurl`)
- Harder to integrate with web infrastructure (proxies, API gateways, service meshes, caches, etc)
- API documentation tooling status is unclear
- Browser support is practically non-existent
- Type system does not always map cleanly to native language type system; integration woes
- No support for `null` values
- Many common types require Protobuf plugins (e.g. timestamps and duration)
- Generated code may be non-idiomatic and hard to use
- Needs a plugin to provide REST API
- Migration will be disruptive and laborious

## Decision

> This section explains all of the details of the proposed solution, including implementation details.
> It should also describe affects / corollary items that may need to be changed as a part of this.
> If the proposed change will be large, please also indicate a way to do the change to maximize ease of review.
> (e.g. the optimal split of things to do between separate PR's)

## Status

> A decision may be "proposed" if it hasn't been agreed upon yet, or "accepted" once it is agreed upon. If a later ADR changes or reverses a decision, it may be marked as "deprecated" or "superseded" with a reference to its replacement.

{Deprecated|Proposed|Accepted}

## Consequences

> This section describes the consequences, after applying the decision. All consequences should be summarized here, not just the "positive" ones.

### Positive

### Negative

### Neutral

## References

> Are there any relevant PR comments, issues that led up to this, or articles referenced for why we made the given design choice? If so link them here!

- {reference link}
